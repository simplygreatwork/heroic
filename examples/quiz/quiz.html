
<div>
	<div class="container">
		<section class="content">
			<header data-title class="title">Quiz</header>
			<div>0 of 0 is 0%.</div>
			<section class="scroll">	
				<section name="template" data-component="../shared/views/empty.html" data-template></section>
				<br><br><br><br><br><br><br>
			</section>
		</section>
		<section name="void" class="void" data-component="../shared/views/empty.html"></section>
	</div>
	<link rel="stylesheet" type="text/css" href="../quiz/quiz.css"/>
	<script type="module">
		
		import { Component } from 'component'
		import { Bus } from 'bus'
		import { Cloud } from 'cloud'
		import { Scope } from 'scope'
		import { bind } from 'bind'
		
		let counter = 0
		
		Component.ready(({ component, data, $ }) => {
			
			const bus = data.bus || new Bus()
			const cloud = Cloud(bus)
			const scope = cloud.scope
			const template = component.child('template')
			const cache = {}
			data['questions'] = {}
			let correct_ = 0
			let total = 0
			
			install_rows(default_items())
			router.exits('quiz', data => scope.unplug(), true)
			listen()
			
			async function install_rows(items) {
				while (items.length > 0) await install_row(items)
			}
			
			function install_row(items) {
				
				return new Promise((resolve) => {
					let item = items.shift()
					let component = template.clone({ item, cloud })
					component.on('ready', (props) => resolve(loaded(props)))
					component.redirect(item.path, { item, cloud })
				})
			}
			
			function loaded({ component, data, $ }) {
				
				const id = component.path
				const correct = $('[data-answer]').dataset.answer
				const submit = $('[type=submit]')
				bind(submit, 'click', (event) => {
					event.preventDefault()
					const answer = $(':checked').value
					scope.emit('submitted', { id, correct, answer })
				}, scope)
			}
			
			function listen() {
				
				scope.on('submitted', ({ id, answer, correct }) => {
					data.questions[id] = data.questions[id] || 0
					data.questions[id] = data.questions[id] + 1
					total++
					if (answer == correct) correct_++
					const { div } = $()
					div[2].innerText = `${correct_} of ${total}`
				})
			}
			
			function default_items() {
				
				return new Array(500).fill(0).map(function(each, index) {
					const id = index + 1
					if (true) return { id, path: `./questions/dynamic.html` }
					return { id, path: `./questions/q${(index % 10) + 1}.html` }
				})
			}
		})
		
	</script>
</div>
